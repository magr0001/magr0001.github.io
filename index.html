<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fitness App</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #333;
            color: #fff;
            margin: 0;
            padding: 20px;
        }
        .exercise-list {
            margin-bottom: 20px;
        }
        .exercise-item {
            background-color: #444;
            margin: 5px 0;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            position: relative;
        }
        .exercise-item.active {
            background-color: #8B0000; /* Dunkelrot */
        }
        .input-section {
            display: none;
            margin-top: 10px;
        }
        .input-section.visible {
            display: block;
        }
        .button {
            background-color: #555;
            border: none;
            color: white;
            padding: 10px;
            cursor: pointer;
            border-radius: 5px;
            margin-top: 5px;
        }
        input[type="text"], input[type="number"], textarea {
            width: calc(100% - 20px);
            padding: 10px;
            margin: 5px 0;
            border: none;
            border-radius: 5px;
        }
        .input-inline {
            display: flex;
            justify-content: space-between;
        }
        .timer {
            font-size: 24px;
            margin-bottom: 20px;
            cursor: pointer;
            display: inline-block;
            margin-right: 10px;
        }
    </style>
</head>
<body>

<div class="timer" id="stopwatch">00:00:00</div>
<div class="timer" id="countdown">02:00</div>

<div class="exercise-list" id="exerciseList"></div>

<div id="addExercise" class="input-section">
    <input type="text" id="exerciseName" placeholder="Übungsname">
    <input type="number" id="exerciseInterval" placeholder="Intervall (Tage)">
    <button class="button" id="saveExercise">Hinzufügen</button>
</div>

<button class="button" id="toggleAddExercise">Neue Übung hinzufügen</button>
<button class="button" id="resetAll">Alle Daten löschen</button>

<script>
    let exercises = JSON.parse(localStorage.getItem('exercises')) || [];
    let timerInterval, countdownInterval;
    let stopwatchSeconds = 0, countdownSeconds = 120;

    const stopwatchDisplay = document.getElementById('stopwatch');
    const countdownDisplay = document.getElementById('countdown');

    // Start/Reset Stopwatch
    stopwatchDisplay.onclick = function () {
        if (timerInterval) return; // Timer läuft bereits
        timerInterval = setInterval(() => {
            stopwatchSeconds++;
            const hours = String(Math.floor(stopwatchSeconds / 3600)).padStart(2, '0');
            const minutes = String(Math.floor((stopwatchSeconds % 3600) / 60)).padStart(2, '0');
            const seconds = String(stopwatchSeconds % 60).padStart(2, '0');
            stopwatchDisplay.innerText = `${hours}:${minutes}:${seconds}`;
        }, 1000);
    };

    // Reset Stopwatch on double-click
    stopwatchDisplay.ondblclick = function () {
        clearInterval(timerInterval);
        timerInterval = null;
        stopwatchSeconds = 0;
        stopwatchDisplay.innerText = '00:00:00';
    };

    // Start Countdown
    countdownDisplay.onclick = function () {
        clearInterval(countdownInterval);
        countdownInterval = setInterval(() => {
            countdownSeconds--;
            if (countdownSeconds < 0) {
                clearInterval(countdownInterval);
                countdownDisplay.innerText = '00:00';
            } else {
                const minutes = String(Math.floor(countdownSeconds / 60)).padStart(2, '0');
                const seconds = String(countdownSeconds % 60).padStart(2, '0');
                countdownDisplay.innerText = `${minutes}:${seconds}`;
            }
        }, 1000);
    };

    // Reset Countdown on double-click
    countdownDisplay.ondblclick = function () {
        clearInterval(countdownInterval);
        countdownSeconds = 120;
        countdownDisplay.innerText = '02:00';
    };

    document.getElementById('toggleAddExercise').onclick = function () {
        const addExerciseSection = document.getElementById('addExercise');
        addExerciseSection.classList.toggle('visible');
    };

    document.getElementById('saveExercise').onclick = function () {
        const name = document.getElementById('exerciseName').value;
        const interval = parseInt(document.getElementById('exerciseInterval').value);
        if (name && !isNaN(interval)) {
            exercises.push({ name, interval, daysRemaining: interval, sets: [], note: '', active: false });
            document.getElementById('exerciseName').value = '';
            document.getElementById('exerciseInterval').value = '';
            saveExercises(); // Speichern nach Hinzufügen
            renderExercises();
        }
    };

    function renderExercises() {
        const exerciseList = document.getElementById('exerciseList');
        exerciseList.innerHTML = '';
        exercises.sort((a, b) => a.daysRemaining - b.daysRemaining).forEach((exercise, index) => {
            const exerciseItem = document.createElement('div');
            exerciseItem.className = 'exercise-item' + (exercise.active ? ' active' : '');
            exerciseItem.innerHTML = `${exercise.name} (${exercise.interval} Tage) - ${exercise.daysRemaining} Tage`;
            exerciseItem.onclick = () => toggleExerciseDetails(index);
            exerciseList.appendChild(exerciseItem);
        });
    }

    function toggleExerciseDetails(index) {
        const exercise = exercises[index];
        exercise.active = !exercise.active; // Wechseln des Status
        saveExercises(); // Speichern nach Änderung

        const exerciseDetails = document.createElement('div');
        exerciseDetails.className = 'input-section' + (exercise.active ? ' visible' : '');
        exerciseDetails.innerHTML = `
            <div class="input-inline">
                <input type="number" placeholder="Gewicht" min="0" />
                <input type="number" placeholder="Wiederholungen" min="0" />
            </div>
            <button class="button" onclick="addSet(${index})">Satz hinzufügen</button>
            <button class="button" onclick="removeExercise(${index})">Übung entfernen</button>
            <button class="button" onclick="saveExercise(${index})">Übung speichern</button>
            <div class="set-list" id="setList-${index}"></div>
        `;

        // Zuklappen, wenn die Übung bereits offen ist
        if (exercise.active) {
            exerciseDetails.style.display = 'block';
            exerciseDetails.querySelector('.set-list').innerHTML = exercise.sets.map(set => 
                `<div class="input-inline">
                    <input type="number" value="${set.weight}" placeholder="Gewicht" min="0" />
                    <input type="number" value="${set.reps}" placeholder="Wiederholungen" min="0" />
                    <button class="button" onclick="removeSpecificSet(${index}, this)">-</button>
                </div>`
            ).join('');
        } else {
            exerciseDetails.style.display = 'none';
        }

        // Füge die Details der Übung nach dem entsprechenden Element hinzu
        exerciseList.appendChild(exerciseDetails);
        renderExercises();
    }

    function addSet(index) {
        exercises[index].sets.push({ weight: 0, reps: 0 }); // Neue Zeile hinzufügen
        saveExercises(); // Speichern nach Hinzufügen
        renderExercises();
    }

    function removeExercise(index) {
        exercises.splice(index, 1);
        saveExercises(); // Speichern nach Entfernen
        renderExercises();
    }

    function removeSpecificSet(index, button) {
        const setIndex = Array.from(button.parentNode.parentNode.children).indexOf(button.parentNode);
        exercises[index].sets.splice(setIndex, 1); // Set löschen
        saveExercises(); // Speichern nach Entfernen
        renderExercises();
    }

    function saveExercise(index) {
        exercises[index].active = false; // Klappen
        exercises[index].daysRemaining -= 1; // Anzahl der Tage verringern
        if (exercises[index].daysRemaining < 0) {
            exercises[index].daysRemaining = 0;
        }
        saveExercises(); // Speichern nach Ändern
        renderExercises();
    }

    function saveExercises() {
        localStorage.setItem('exercises', JSON.stringify(exercises));
    }

    function dailyIntervalDecrement() {
        exercises.forEach(exercise => {
            if (exercise.daysRemaining > 0) {
                exercise.daysRemaining -= 1;
            }
        });
        saveExercises(); // Speichern nach täglichem Runterzählen
        renderExercises();
    }

    // Tägliches Runterzählen
    const lastRun = localStorage.getItem('lastRun');
    const today = new Date().toISOString().split('T')[0];
    if (lastRun !== today) {
        dailyIntervalDecrement();
        localStorage.setItem('lastRun', today);
    }

    renderExercises();
</script>
</body>
</html>