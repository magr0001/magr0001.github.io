<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workout Tracker</title>
    <style>
        /* Dark Mode Styles */
        body {
            font-family: Arial, sans-serif;
            background-color: #1e1e1e;
            color: #ffffff;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .exercise-list, .input-section {
            width: 90%;
            max-width: 600px;
            margin-top: 20px;
            padding: 10px;
            border-radius: 8px;
            background-color: #2e2e2e;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .exercise-item {
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #444;
            border-radius: 5px;
            background-color: #333;
            display: flex;
            flex-direction: column;
        }

        .exercise-item.due {
            background-color: #ff4d4d;
        }

        .exercise-item.active {
            background-color: #3b3b3b;
        }

        .input-inline {
            display: flex;
            gap: 10px;
            margin-top: 5px;
        }

        .input-inline input {
            flex: 1;
            padding: 5px;
            border: 1px solid #555;
            border-radius: 4px;
            background-color: #444;
            color: #fff;
        }

        textarea {
            width: 100%;
            padding: 5px;
            margin-top: 5px;
            border: 1px solid #555;
            border-radius: 4px;
            background-color: #444;
            color: #fff;
            resize: vertical;
        }

        button {
            background-color: #007bff;
            color: #fff;
            border: none;
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        button:hover {
            background-color: #0056b3;
        }

        button.button-gray {
            background-color: #6c757d;
            color: #fff;
        }

        .button:disabled {
            background-color: #555;
            cursor: not-allowed;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>

<div class="exercise-list" id="exerciseList"></div>

<div id="addExercise" class="input-section hidden">
    <input type="text" id="exerciseName" placeholder="Übungsname">
    <input type="number" id="exerciseInterval" placeholder="Intervall (Tage)">
    <button class="button" id="saveExercise">Hinzufügen</button>
</div>

<button class="button" id="toggleAddExercise">Neue Übung hinzufügen</button>
<button class="button button-gray" id="resetAll">Alle Daten löschen</button>

<script>
    let exercises = JSON.parse(localStorage.getItem('exercises')) || [];

    document.getElementById('toggleAddExercise').onclick = function () {
        document.getElementById('addExercise').classList.toggle('hidden');
    };

    document.getElementById('saveExercise').onclick = function () {
        const name = document.getElementById('exerciseName').value;
        const interval = parseInt(document.getElementById('exerciseInterval').value);
        if (name && !isNaN(interval)) {
            exercises.push({
                name,
                interval,
                lastCompleted: null,
                sets: [{ weight: 0, reps: 0 }],
                note: ''
            });
            document.getElementById('exerciseName').value = '';
            document.getElementById('exerciseInterval').value = '';
            saveExercises();
            renderExercises();
        }
    };

    function renderExercises() {
        const exerciseList = document.getElementById('exerciseList');
        exerciseList.innerHTML = '';
        const today = new Date().toISOString().split('T')[0];

        // Sortieren nach verbleibenden Tagen
        exercises.sort((a, b) => calculateDaysRemaining(a, today) - calculateDaysRemaining(b, today));

        exercises.forEach((exercise, index) => {
            const daysRemaining = calculateDaysRemaining(exercise, today);
            const due = daysRemaining <= 0;

            const exerciseItem = document.createElement('div');
            exerciseItem.className = `exercise-item ${due ? 'due' : 'active'}`;
            exerciseItem.innerHTML = `
                ${exercise.name} (${exercise.interval} Tage) - Tage: ${daysRemaining}
                <div class="input-section hidden" id="details-${index}">
                    <textarea placeholder="Notizen">${exercise.note}</textarea>
                    <div class="set-list" id="setList-${index}"></div>
                    <div class="input-inline">
                        <input type="number" placeholder="Gewicht" min="0" onchange="updateSet(${index}, 0, this.value, null)" value="${exercise.sets[0].weight}" />
                        <input type="number" placeholder="Wiederholungen" min="0" onchange="updateSet(${index}, 0, null, this.value)" value="${exercise.sets[0].reps}" />
                    </div>
                    <button class="button" onclick="addSet(${index})">Satz hinzufügen</button>
                    <button class="button button-gray" onclick="removeSet(${index})">Satz entfernen</button>
                    <button class="button" onclick="markAsCompleted(${index})">Übung speichern</button>
                    <button class="button button-gray" onclick="removeExercise(${index})">Übung entfernen</button>
                </div>
            `;
            exerciseItem.onclick = () => toggleDetails(index);
            exerciseList.appendChild(exerciseItem);
            renderSets(index);
        });
    }

    function calculateDaysRemaining(exercise, today) {
        if (!exercise.lastCompleted) return exercise.interval;
        const lastDate = new Date(exercise.lastCompleted);
        const currentDate = new Date(today);
        const differenceInTime = currentDate - lastDate;
        const differenceInDays = Math.floor(differenceInTime / (1000 * 3600 * 24));
        return exercise.interval - differenceInDays;
    }

    function toggleDetails(index) {
        document.getElementById(`details-${index}`).classList.toggle('hidden');
    }

    function updateSet(index, setIndex, weight, reps) {
        if (weight !== null) exercises[index].sets[setIndex].weight = weight;
        if (reps !== null) exercises[index].sets[setIndex].reps = reps;
        saveExercises();
    }

    function addSet(index) {
        exercises[index].sets.push({ weight: 0, reps: 0 });
        saveExercises();
        renderExercises();
    }

    function removeSet(index) {
        if (exercises[index].sets.length > 1) {
            exercises[index].sets.pop();
            saveExercises();
            renderExercises();
        }
    }

    function markAsCompleted(index) {
        const today = new Date().toISOString().split('T')[0];
        exercises[index].lastCompleted = today;
        exercises[index].note = document.querySelector(`#details-${index} textarea`).value;
        saveExercises();
        renderExercises();
    }

    function removeExercise(index) {
        exercises.splice(index, 1);
        saveExercises();
        renderExercises();
    }

    function saveExercises() {
        localStorage.setItem('exercises', JSON.stringify(exercises));
    }

    function dailyIntervalDecrement() {
        const today = new Date().toISOString().split('T')[0];
        exercises.forEach(exercise => {
            if (exercise.lastCompleted) {
                exercise.daysRemaining = calculateDaysRemaining(exercise, today);
            }
        });
        saveExercises();
        renderExercises();
    }

    const lastRun = localStorage.getItem('lastRun');
    const today = new Date().toISOString().split('T')[0];
    if (lastRun !== today) {
        dailyIntervalDecrement();
        localStorage.setItem('lastRun', today);
    }

    renderExercises();
</script>
</body>
</html>